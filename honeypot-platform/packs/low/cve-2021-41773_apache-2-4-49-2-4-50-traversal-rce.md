# Apache httpd 2.4.49/2.4.50 Traversal + RCE (low-interaction)

## CVE profile
- **Primary CVEs:** CVE-2021-41773 (path traversal / file read) and CVE-2021-42013 (incomplete fix bypass, enabling traversal and CGI RCE patterns).
- **Product:** Apache HTTP Server (`httpd`) 2.4.49 and 2.4.50.
- **Vulnerability family:** Path normalization bypass with traversal into sensitive filesystem paths; when CGI is enabled, traversal to shell binaries can be used for command execution attempts.
- **Exposed surface:** HTTP on common web ports, especially paths under `/cgi-bin/` and sometimes `/icons/` with encoded traversal segments.
- **Attacker objectives:**
  - Retrieve sensitive files (for example passwd-style files).
  - Reach CGI-capable executable paths (for example shell entrypoints) and send command-style bodies.

## Transcript-derived request patterns emulated

### Primary probes
1. **Traversal file-read probe (`GET`)**
   - Distinctive structure: encoded traversal segments in path plus `etc/passwd` target.
   - Emulated by behavior `traversal-passwd-probe`.

2. **Traversal-to-CGI RCE probe (`POST`)**
   - Distinctive structure: encoded traversal path ending in `bin/sh` under `/cgi-bin/`.
   - Emulated by behavior `cgi-rce-binsh-probe`.
   - Request body is stored as compressed artifact for analysis.

3. **Double-encoded traversal normalization probe (`GET`)**
   - Distinctive structure: double-encoded dot segments (`%%32%65` style) plus sensitive target path.
   - Emulated by behavior `traversal-normalization-probe`.

### Secondary follow-up
- `GET /` landing probe with Apache-like banner and “It works!” response.

### Negative matching intent
- The pack does **not** match only on user-agent.
- The pack does **not** require exact payload command strings.
- Matching focuses on stable path/encoding traits to avoid overfitting.

## Telemetry contract
- Global tags in metadata:
  - `cve:2021-41773`
  - `cve:2021-42013`
  - `product:apache-httpd`
  - `technique:path-traversal`
  - `technique:rce`
- Verdicts emitted: `probe`, `exploit`, `unknown`.
- Indicators used:
  - `file-read-probe`
  - `cgi-bin-sh-exec`
  - `double-encoded-dot-segments`
- Header redaction: `Authorization`, `Cookie`.
- Body capture: enabled for `POST` CGI RCE probe (`store_body` with gzip).

## How to run
From the repository root:

```bash
python -m hoho_runtime.cli validate honeypot-platform/packs/low/cve-2021-41773_apache-2-4-49-2-4-50-traversal-rce.yaml
PYTHONPATH=honeypot-platform/packages/hoho_core:honeypot-platform/packages/hoho_runtime \
  python -m hoho_runtime.cli run honeypot-platform/packs/low/cve-2021-41773_apache-2-4-49-2-4-50-traversal-rce.yaml
```

## Harmless test requests

```bash
curl -i http://127.0.0.1:8088/
curl -i "http://127.0.0.1:8088/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"
curl -i -X POST "http://127.0.0.1:8088/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh" -d "echo test"
```

## Known limitations
- This is behavioral emulation only; no real Apache parser, CGI runtime, or filesystem access exists.
- Only selected transcript patterns are emulated; many variants may hit the default `404`/`unknown` rule.
- Response bodies are intentionally minimal to avoid acting as a real vulnerable target.
